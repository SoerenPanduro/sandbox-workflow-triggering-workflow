name: Post Build
on: 
  workflow_run:
    workflows: ["Build"]
    types:
      - completed
jobs:
  test_get_artifact:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4 # Expect not to check out any files - but need the SHA info for later use
      with:
        sparse-checkout: |
          nothing
        sparse-checkout-cone-mode: false  
    - name: Set up download environment
      run: |
        ls -R
        ARTIFACTS_SHA=$(git rev-parse HEAD)
        echo "Expected artifacts folder is: Artifacts_$ARTIFACTS_SHA"
        echo "ARTIFACTS_SHA=$ARTIFACTS_SHA" >> $GITHUB_ENV
#        echo "Artifact was made from run ID: ${{github.event.workflow_run.id }}"
#        echo "ARTIFACT_RUN_ID=${{ github.event.workflow_run.id }}" >> $GITHUB_ENV
    - name: Download the Build Artifact
      uses: actions/download-artifact@v4.1.1
      with:
#        name: Artifacts_${{ env.ARTIFACTS_SHA }} # If specified, files will be extracted to the root folder!
        github-token: ${{ secrets.GITHUB_TOKEN }} # ${{ secrets.GH_PAT }}  # optional
        run-id: ${{ github.event.workflow_run.id }}

    - name: Repository after download
      run: |
        ls -R
# Optionally - rename Artifacts_${{ env.ARTIFACTS_SHA }} to some static name - 
#   mv Artifacts_${{ env.ARTIFACTS_SHA }} artifacts
    - name: What triggered this workflow?
      run: |
        echo "github.event.workflow_run.id data: ${{ github.event.workflow_run.id }}"
        
